---
description: "BattlesPageに表示するお知らせカルーセルの実装仕様"
globs: ["src/pages/Battle/BattlesPage.tsx"]
alwaysApply: false
---

# お知らせカルーセル実装仕様書 (v2)

## 1️⃣ 概要
`BattlesPage` の上部に、お知らせやガイドを表示するためのカルーセルを実装する。データソースとしてヘッドレスCMSである **MicroCMS** を利用し、動的なコンテンツ管理を可能にする。

### 1.1 背景
当初、Supabase の `site_news` テーブルを利用してお知らせ機能の実装を計画していた (`最新ニュース実装仕様書.v1`)。しかし、より柔軟なコンテンツ管理と、視覚的に魅力的なUIを提供するため、`BattlesPage` にカルーセルを導入し、MicroCMS でコンテンツを管理する方式に変更する。

### 1.2 主な仕様
- **表示場所**: `BattlesPage` の上部。既存の「How-to Guide」コンポーネントのエリアを置き換える。
- **カルーセル構成**:
    1.  **固定パネル**: 最初のスライドは「How-to Guide」への導線として固定表示する。クリックするとガイドモーダルが開く。
    2.  **動的パネル**: 2枚目以降は、MicroCMS から取得したお知らせ記事を新しい順に表示する。
- **動作**:
    - 自動でスライドする。
    - ユーザーが手動でスライド操作することも可能。
    - 一度に表示するパネルは1つ。

---

## 2️⃣ CMS 設計 (MicroCMS)

### 2.1 API (エンドポイント)
- **API名**: お知らせ
- **エンドポイント**: `news`

### 2.2 スキーマ定義
| フィールドID | 表示名       | 種類             | 説明                                   |
| :----------- | :----------- | :--------------- | :------------------------------------- |
| `title`      | タイトル     | テキストフィールド | カルーセルに表示する見出し。           |
| `content`    | 本文         | リッチエディタ   | お知らせの詳細な内容。                 |
| `eyecatch`   | アイキャッチ | 画像             | カルーセルの背景画像として使用。       |
| `link`       | リンクURL    | テキストフィールド | (任意) クリック時に遷移させたい外部リンク。 |

---

## 3️⃣ フロントエンド実装

### 3.1 使用ライブラリ
- **UIコンポーネント**: `shadcn/ui` の `Carousel` を使用する。
- **CMSクライアント**: `microcms-js-sdk`

### 3.2 環境変数
`.env` ファイルに MicroCMS の接続情報を追加する。
```env
VITE_MICROCMS_SERVICE_DOMAIN="YOUR_SERVICE_DOMAIN"
VITE_MICROCMS_API_KEY="YOUR_API_KEY"
```

### 3.3 実装タスク
1.  **ライブラリのインストール**:
    ```bash
    pnpm add microcms-js-sdk
    pnpm dlx shadcn-ui@latest add carousel
    ```
2.  **MicroCMS クライアントの作成**:
    - `src/lib/microcms.ts` を作成し、`microcms-js-sdk` を初期化するクライアントを定義する。
3.  **カルーセルコンポーネントの作成**:
    - `src/components/battle/NewsCarousel.tsx` を新規作成する。
    - このコンポーネント内で MicroCMS からデータをフェッチし、カルーセルを表示する。
    - ローディング状態とエラー状態を適切にハンドリングする。
4.  **`BattlesPage` の改修**:
    - `src/pages/Battle/BattlesPage.tsx` を編集し、既存の `How-to Guide` コンポーネントを `NewsCarousel` コンポーネントに置き換える。
5.  **型定義**:
    - `src/types/microcms.ts` を作成し、API スキーマに合わせた型を定義する。

---

## 4️⃣ 運用フロー
1.  MicroCMS の管理画面にログインする。
2.  「お知らせ」API を選択し、新しいコンテンツを追加する。
3.  各フィールド（タイトル、本文、アイキャッチ等）を入力し、公開する。
4.  `BattlesPage` にアクセスすると、追加したお知らせがカルーセルに自動で反映される。

---

## ✅ 検証項目
- [ ] `BattlesPage` にカルーセルが表示されるか。
- [ ] 最初のパネルが「How-to Guide」であり、クリックするとモーダルが開くか。
- [ ] 2枚目以降に MicroCMS で登録したお知らせが新しい順に表示されるか。
- [ ] カルーセルが自動でスライドするか。
- [ ] 左右の矢印ボタン、またはスワイプで手動スライドができるか。
- [ ] お知らせが0件の場合でもレイアウトが崩れないか。（How-to Guide のみ表示）
- [ ] お知らせの画像（アイキャッチ）が正しく表示されるか。
- [ ] ローディング中、スケルトンUIなどが表示されるか。
