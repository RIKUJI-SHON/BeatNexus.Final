# 2025-07-22_シーズン報酬システム仕様書作成.mdc

**日付**: 2025年7月22日  
**作業者**: AI Assistant  
**実装内容**: シーズン終了時の限定バッジ・アイコンフレーム付与システムの仕様書作成

---

## 📋 実装概要

### 実施内容
シーズンごとの功績に応じて、ユーザーに収集・設定可能なデジタルアイテム（バッジ・アイコンフレーム）を付与するシステムの包括的な仕様書を作成。

### 主要機能
1. **限定バッジの収集・表示システム**
2. **アイコンフレームのカスタマイズ機能**
3. **コレクション管理ページ**
4. **自動報酬付与プロセス**
5. **特別通知システム**

---

## 🗂️ 成果物

### 作成ファイル
- `docs/シーズン報酬システム仕様書.md` - 包括的なシステム仕様書（13章構成）

### 仕様書の構成内容

#### 1. システム設計
- **データベース設計**: `rewards`テーブル（マスターデータ）、`user_rewards`テーブル（所有権管理）
- **既存テーブル拡張**: `profiles`テーブルに`equipped_frame_id`カラム追加
- **RLS設定**: セキュリティポリシーの定義

#### 2. ユーザー体験設計
- **コレクションページ**: プロフィール内に新規タブ追加、グリッドレイアウト
- **アイコンフレーム設定**: プロフィール編集での選択UI、リアルタイムプレビュー
- **レスポンシブ対応**: モバイル2列、タブレット3列、デスクトップ4列グリッド

#### 3. 自動化プロセス
- **報酬付与関数**: `grant_season_rewards(season_id)`の詳細実装
- **通知システム連携**: 新しい通知タイプ`reward_earned`の追加
- **シーズン終了処理**: pg_cronとの連携フロー

#### 4. 技術実装計画
- **フロントエンド**: 新規コンポーネント群の設計
- **カスタムフック**: `useUserRewards`, `useFrameImage`
- **状態管理**: Zustand拡張仕様

#### 5. 運用・最適化
- **パフォーマンス考慮**: インデックス設計、画像最適化、仮想化スクロール
- **セキュリティ**: 不正防止、権限管理、監査追跡
- **監視・メトリクス**: 運用監視指標の定義

---

## 🔗 既存システムとの連携

### 重複実装の回避確認
✅ **既存プロフィールシステム**: 新機能は既存の`ProfilePage.tsx`を拡張する形で設計  
✅ **シーズンシステム**: 既存の`seasons`テーブルと`season_rankings`テーブルを活用  
✅ **通知システム**: 既存の`notifications`テーブルを拡張、新しい通知タイプを追加  
✅ **ランキングシステム**: 既存のランキング機能と連携した報酬付与条件を設計

### 既存ルールの遵守
- BeatNexus.mdcの技術スタック・データベース設計方針に準拠
- 既存のRLSポリシーパターンを踏襲
- 国際化（react-i18next）対応を含む設計
- レスポンシブデザインの一貫性を維持

---

## 📈 実装優先度

### Phase 1: 基盤実装（必須）
- データベーステーブル作成
- RLS設定
- grant_season_rewards関数実装
- 基本的なコレクションページ作成

### Phase 2: UI/UX実装
- バッジ・フレーム表示コンポーネント
- プロフィール編集でのフレーム選択
- 報酬獲得通知システム
- レスポンシブ対応

### Phase 3: 最適化・拡張
- パフォーマンス最適化
- 高度なフィルタリング機能
- アニメーション・エフェクト強化
- 分析・監視ダッシュボード

---

## 🎯 次のステップ

1. **開発環境での実装開始**: テストDB(`wdttluticnlqzmqmfvgt`)でのマイグレーション実行
2. **プロトタイプ作成**: 基本的なコレクションページの実装
3. **データ投入**: βシーズン0の報酬定義データ作成
4. **テスト実行**: 報酬付与プロセスの動作確認

---

## 💡 特記事項

- **セキュリティ重視**: 報酬付与は必ずサーバーサイドで実行、不正付与を防止
- **拡張性考慮**: 将来的な新しい報酬タイプ（テーマ、効果音など）への対応を想定
- **ユーザーエンゲージメント**: 収集要素によるプラットフォーム愛着度向上を目指す
- **運用フレンドリー**: 運営側での報酬管理・付与が容易な設計

---

**実装完了日時**: 2025年7月22日  
**レビュー状況**: 仕様書作成完了、実装待ち  
**関連ドキュメント**: 
- `docs/シーズン報酬システム仕様書.md`
- `docs/BeatNexus.mdc`
- `docs/シーズンシステム仕様書.md`
- `docs/通知システム仕様書.md`
