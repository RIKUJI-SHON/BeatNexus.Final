# ğŸ“ æ–°ã—ã„FFmpegåœ§ç¸®ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ãƒ­ã‚°

## ğŸ“… å®Ÿè£…æ—¥
2025-01-15

## ğŸ¯ æ¦‚è¦
PostPage.tsxã®æ—¢å­˜åœ§ç¸®æ©Ÿèƒ½ã‚’å‰Šé™¤ã—ã€æ–°ã—ã„FFmpeg.wasmãƒ™ãƒ¼ã‚¹ã®åœ§ç¸®ã‚·ã‚¹ãƒ†ãƒ ã‚’çµ±åˆã€‚
è¤‡é›‘ãªæ®µéšçš„åœ§ç¸®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ«ãƒ¼ãƒˆåˆ†å²ã‚·ã‚¹ãƒ†ãƒ ã«ç½®ãæ›ãˆã€
ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å®šæ€§ã¨ä¿å®ˆæ€§ã‚’å¤§å¹…ã«å‘ä¸Šã€‚

## ğŸ” ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ
### æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®è¤‡é›‘æ€§
- **è¤‡é›‘ãªåœ§ç¸®è¨­å®š**: 4æ®µéšã®åœ§ç¸®è¨­å®šã¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¯”ç‡è¨ˆç®—
- **è¨ºæ–­UI**: åœ§ç¸®çŠ¶æ³ã‚’è¡¨ç¤ºã™ã‚‹è¤‡é›‘ãªUIè¦ç´ 
- **çŠ¶æ…‹ç®¡ç†**: 12å€‹ã®çŠ¶æ…‹å¤‰æ•°ã«ã‚ˆã‚‹è¤‡é›‘ãªçŠ¶æ…‹ç®¡ç†
- **é‡è¤‡å‡¦ç†**: è¤‡æ•°ã®åœ§ç¸®å‡¦ç†ãƒ‘ã‚¹ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

## ğŸ“ å®Ÿè£…å†…å®¹

### âœ… æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®å‰Šé™¤
**å‰Šé™¤ã•ã‚ŒãŸæ©Ÿèƒ½**:
- `getCompressionSettings()` - æ®µéšçš„åœ§ç¸®è¨­å®šé–¢æ•°
- `compressVideoAuto()` - è¤‡é›‘ãªè‡ªå‹•åœ§ç¸®é–¢æ•°
- `getCompressionSuggestions()` - åœ§ç¸®ææ¡ˆã‚·ã‚¹ãƒ†ãƒ 
- è¨ºæ–­UIï¼ˆåœ§ç¸®ç‡è¡¨ç¤ºã€ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è©³ç´°ç­‰ï¼‰
- è¤‡é›‘ãªçŠ¶æ…‹å¤‰æ•°ï¼ˆ12å€‹â†’6å€‹ã«å‰Šæ¸›ï¼‰

### âœ… æ–°ã—ã„FFmpegã‚·ã‚¹ãƒ†ãƒ ã®çµ±åˆ
**çµ±åˆã•ã‚ŒãŸæ©Ÿèƒ½**:
```typescript
// useVideoProcessorãƒ•ãƒƒã‚¯ã®çµ±åˆ
const { 
  processVideo, 
  isLoading: isProcessing, 
  progress, 
  isReady: isFFmpegLoaded
} = useVideoProcessor();

// FFmpegã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®ç®¡ç†
const [ffmpegError, setFfmpegError] = useState<string | null>(null);
const [stage, setStage] = useState<string>('');
```

### âœ… çµ±åˆã•ã‚ŒãŸå‡¦ç†ãƒ•ãƒ­ãƒ¼
```typescript
const processVideoFile = async (file: File) => {
  // 1. å‹•ç”»æ™‚é–“ãƒã‚§ãƒƒã‚¯
  const duration = await getVideoDuration(file);
  if (!isValidDuration(duration, battleFormat)) {
    setError(getDurationErrorMessage(duration, battleFormat, t));
    return;
  }
  
  // 2. FFmpegå‡¦ç†å®Ÿè¡Œ
  const processedResult = await processVideo(file);
  
  // 3. Blobâ†’Fileå¤‰æ›
  const processedFile = processedResult instanceof File 
    ? processedResult 
    : new File([processedResult], fileName, { type: 'video/mp4' });
  
  // 4. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¨­å®š
  setVideoFile(processedFile);
  setVideoPreviewUrl(URL.createObjectURL(processedFile));
  setStep('preview');
};
```

### âœ… UIã®ç°¡ç´ åŒ–
**å‰Šé™¤ã•ã‚ŒãŸUIè¦ç´ **:
- è¤‡é›‘ãªåœ§ç¸®è¨­å®šè¡¨ç¤º
- æ®µéšçš„åœ§ç¸®ææ¡ˆãƒ¢ãƒ¼ãƒ€ãƒ«
- è¨ºæ–­æƒ…å ±ãƒ‘ãƒãƒ«
- åœ§ç¸®ç‡è¨ˆç®—è¡¨ç¤º

**è¿½åŠ ã•ã‚ŒãŸUIè¦ç´ **:
- FFmpegåˆæœŸåŒ–çŠ¶æ…‹è¡¨ç¤º
- ã‚·ãƒ³ãƒ—ãƒ«ãªå‡¦ç†é€²æ—è¡¨ç¤º
- ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®æ˜ç¢ºãªè¡¨ç¤º

### âœ… ç¿»è¨³ã‚·ã‚¹ãƒ†ãƒ ã®æ›´æ–°
**è¿½åŠ ã•ã‚ŒãŸç¿»è¨³ã‚­ãƒ¼**:
```json
// è‹±èª
"ffmpeg": {
  "initializing": "Initializing FFmpeg...",
  "initializingDescription": "Please wait while we prepare the video compression engine.",
  "initializationError": "FFmpeg Initialization Error"
},
"processing": {
  "processingVideo": "Processing video..."
}

// æ—¥æœ¬èª
"ffmpeg": {
  "initializing": "FFmpegã‚’åˆæœŸåŒ–ä¸­...",
  "initializingDescription": "å‹•ç”»åœ§ç¸®ã‚¨ãƒ³ã‚¸ãƒ³ã‚’æº–å‚™ä¸­ã§ã™ã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚",
  "initializationError": "FFmpegåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼"
},
"processing": {
  "processingVideo": "å‹•ç”»ã‚’å‡¦ç†ä¸­..."
}
```

## ğŸ”§ æŠ€è¡“è©³ç´°

### å‡¦ç†ãƒ•ãƒ­ãƒ¼
```
1. ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
2. å‹•ç”»æ™‚é–“ãƒã‚§ãƒƒã‚¯ï¼ˆ60-120ç§’ï¼‰
3. FFmpegå‡¦ç†ï¼ˆ<200MB: ã‚¹ã‚­ãƒƒãƒ—, 200MB+: åœ§ç¸®, 2GB+: ã‚¨ãƒ©ãƒ¼ï¼‰
4. Blobâ†’Fileå¤‰æ›
5. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
6. æŠ•ç¨¿å‡¦ç†
```

### çŠ¶æ…‹ç®¡ç†ã®ç°¡ç´ åŒ–
```typescript
// å‰Šé™¤ã•ã‚ŒãŸçŠ¶æ…‹å¤‰æ•°
- processingProgress, processingStage
- showCompressionOption, showAutoCompression
- isProcessingï¼ˆç‹¬è‡ªå®Ÿè£…ï¼‰
- è¤‡é›‘ãªåœ§ç¸®è¨­å®šçŠ¶æ…‹

// æ®‹ã•ã‚ŒãŸçŠ¶æ…‹å¤‰æ•°
- videoFile, videoPreviewUrl
- isDragging, isUploading
- step, error, videoDuration
- acceptedGuidelines, acceptedFacePolicy, acceptedContent
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```typescript
// FFmpegç‰¹æœ‰ã®ã‚¨ãƒ©ãƒ¼
if (err instanceof Error && err.message.includes('FFmpeg')) {
  setFfmpegError(err.message);
} else {
  setError(err instanceof Error ? err.message : t('postPage.errors.videoProcessingFailed'));
}
```

## ğŸ¯ è§£æ±ºã•ã‚ŒãŸå•é¡Œ
1. **è¤‡é›‘æ€§å‰Šæ¸›**: æ®µéšçš„åœ§ç¸®ãƒ­ã‚¸ãƒƒã‚¯ã®å®Œå…¨é™¤å»
2. **ä¿å®ˆæ€§å‘ä¸Š**: çŠ¶æ…‹å¤‰æ•°ã‚’12å€‹ã‹ã‚‰6å€‹ã«å‰Šæ¸›
3. **å®‰å®šæ€§å‘ä¸Š**: FFmpeg.wasmã«ã‚ˆã‚‹å®‰å®šã—ãŸåœ§ç¸®å‡¦ç†
4. **UIç°¡ç´ åŒ–**: ä¸è¦ãªè¨ºæ–­UIã®å‰Šé™¤
5. **å‹å®‰å…¨æ€§**: Blobâ†’Fileå¤‰æ›ã«ã‚ˆã‚‹å‹æ•´åˆæ€§ç¢ºä¿

## ğŸ“Š å½±éŸ¿ç¯„å›²
- **PostPage.tsx**: å®Œå…¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆ500è¡Œâ†’400è¡Œï¼‰
- **ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«**: FFmpegé–¢é€£ã‚­ãƒ¼ã®è¿½åŠ 
- **çŠ¶æ…‹ç®¡ç†**: å¤§å¹…ãªç°¡ç´ åŒ–
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“**: ã‚ˆã‚Šç›´æ„Ÿçš„ã§ã‚·ãƒ³ãƒ—ãƒ«ãªæ“ä½œ

## ğŸš€ ä»Šå¾Œã®é‹ç”¨æŒ‡é‡

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- FFmpegåˆæœŸåŒ–ã®æœ€é©åŒ–
- å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã®æ”¹å–„
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç›£è¦–

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“å‘ä¸Š
- å‡¦ç†æ™‚é–“ã®çŸ­ç¸®
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ”¹å–„
- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã®ç²¾åº¦å‘ä¸Š

## âœ… æ¤œè¨¼é …ç›®
- [x] ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã®è§£æ¶ˆ
- [x] TypeScriptã‚¨ãƒ©ãƒ¼ã®ä¿®æ­£
- [x] ç¿»è¨³ã‚­ãƒ¼ã®è¿½åŠ 
- [x] æ—¢å­˜æ©Ÿèƒ½ã®ç¶­æŒ
- [ ] å®Ÿéš›ã®å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆ
- [ ] å„ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®å‹•ä½œç¢ºèª

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»æ©Ÿèƒ½
- `src/pages/PostPage.tsx` - ãƒ¡ã‚¤ãƒ³ã®çµ±åˆãƒ•ã‚¡ã‚¤ãƒ«
- `src/hooks/useVideoProcessor.ts` - FFmpegå‡¦ç†ãƒ•ãƒƒã‚¯
- `src/i18n/locales/en.json` - è‹±èªç¿»è¨³
- `src/i18n/locales/ja.json` - æ—¥æœ¬èªç¿»è¨³
- `vite.config.ts` - SharedArrayBufferè¨­å®š
- `public/ffmpeg/` - FFmpegã‚¢ã‚»ãƒƒãƒˆ

## ğŸ”„ å®Ÿè£…ã®ç‰¹å¾´

### ã‚·ãƒ³ãƒ—ãƒ«ãªè¨­è¨ˆå“²å­¦
- **å˜ç´”ãªãƒ«ãƒ¼ãƒˆåˆ†å²**: è¤‡é›‘ãªæ¡ä»¶åˆ†å²ã®æ’é™¤
- **æ˜ç¢ºãªè²¬ä»»åˆ†é›¢**: UIãƒ­ã‚¸ãƒƒã‚¯ã¨å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†é›¢
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: åˆ†ã‹ã‚Šã‚„ã™ã„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

### æ—¢å­˜æ©Ÿèƒ½ã®å®Œå…¨ç¶­æŒ
- **24æ™‚é–“æŠ•ç¨¿åˆ¶é™**: å®Œå…¨ã«ç¶­æŒ
- **ãƒãƒˆãƒ«å½¢å¼**: MAIN_BATTLEå›ºå®šã‚’ç¶­æŒ
- **ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³**: æ—¢å­˜ã®UI/UXã‚’å®Œå…¨ã«ä¿æŒ
- **æŠ•ç¨¿ãƒ•ãƒ­ãƒ¼**: æ—¢å­˜ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç¶­æŒ

---
**å®Ÿè£…è€…**: AI Assistant  
**ãƒ¬ãƒ“ãƒ¥ãƒ¼**: è¦ãƒ¬ãƒ“ãƒ¥ãƒ¼  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: çµ±åˆå®Œäº†ã€å®Ÿå‹•ä½œãƒ†ã‚¹ãƒˆå¾…ã¡
