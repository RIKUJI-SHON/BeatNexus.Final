# Edge Functionä¿®æ­£ä»•æ§˜æ›¸ - é›»è©±ç•ªå·èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 

## ğŸ“‹ å®Ÿè£…ãƒ­ã‚°

**ä½œæˆæ—¥**: 2025å¹´1æœˆ28æ—¥  
**å¯¾è±¡**: phone-verification Edge Function ã®ä¿®æ­£ä»•æ§˜  
**ç·Šæ€¥åº¦**: ğŸ”´ é«˜ï¼ˆç¾åœ¨ã®å®Ÿè£…ã«é‡å¤§ãªæ¬ é™¥ã‚ã‚Šï¼‰  
**é–¢é€£**: é›»è©±ç•ªå·é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½è¦ä»¶å®šç¾©æ›¸ã€DBè¨­è¨ˆä»•æ§˜æ›¸

## ğŸš¨ ç¾åœ¨ã®å•é¡ŒçŠ¶æ³

### Edge Function ã®é‡å¤§ãªå•é¡Œ
1. **å­˜åœ¨ã—ãªã„DBé–¢æ•°ã®å‘¼ã³å‡ºã—**: `check_phone_availability`, `record_phone_verification` ãŒæœªå®Ÿè£…
2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¸å‚™**: DBé–¢æ•°ã‚¨ãƒ©ãƒ¼æ™‚ã®é©åˆ‡ãªå‡¦ç†ãŒãªã„
3. **ãƒ­ã‚°è¨˜éŒ²ä¸è¶³**: é‡è¦ãªæ“ä½œã®ç›£æŸ»ãƒ­ã‚°ãŒä¸è¶³
4. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™æœªå®Ÿè£…**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã§ã®åˆ¶é™ãŒãªã„
5. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°ä¸è¶³**: ä¸æ­£è©¦è¡Œã®è¨˜éŒ²ãŒãªã„

## ğŸ¯ ä¿®æ­£è¦ä»¶

### 1. æ©Ÿèƒ½è¦ä»¶

#### 1.1 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
**FR-001**: DBé–¢æ•°å‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼ã®é©åˆ‡ãªå‡¦ç†
- **æ¦‚è¦**: å­˜åœ¨ã—ãªã„é–¢æ•°å‘¼ã³å‡ºã—æ™‚ã®ã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«ã‚­ãƒ£ãƒƒãƒ
- **å¯¾å¿œ**: try-catch ã«ã‚ˆã‚‹ä¾‹å¤–å‡¦ç†ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
- **ãƒ­ã‚°**: è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’ç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²

**FR-002**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **æ¦‚è¦**: æŠ€è¡“çš„ã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¤‰æ›
- **å¤šè¨€èªå¯¾å¿œ**: æ—¥æœ¬èªãƒ»è‹±èªã§ã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ã‚·ã‚¹ãƒ†ãƒ å†…éƒ¨æƒ…å ±ã®æ¼æ´©é˜²æ­¢

#### 1.2 ãƒ­ã‚°æ©Ÿèƒ½å¼·åŒ–
**FR-003**: åŒ…æ‹¬çš„ãªç›£æŸ»ãƒ­ã‚°
- **æ¦‚è¦**: å…¨ã¦ã®é‡è¦ãªæ“ä½œã‚’ç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²
- **å¯¾è±¡**: SMSé€ä¿¡ã€OTPæ¤œè¨¼ã€é‡è¤‡ãƒã‚§ãƒƒã‚¯ã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
- **è©³ç´°**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±ã€å®Ÿè¡Œæ™‚é–“ã€çµæœ

**FR-004**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°è¨˜éŒ²
- **æ¦‚è¦**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ã‚¤ãƒ™ãƒ³ãƒˆã®è¨˜éŒ²
- **å¯¾è±¡**: é‡è¤‡è©¦è¡Œã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™é•åã€ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹
- **åˆ†æ**: ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æã®ãŸã‚ã®æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿

#### 1.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
**FR-005**: å®Ÿè¡Œæ™‚é–“ã®æ¸¬å®šã¨æœ€é©åŒ–
- **æ¦‚è¦**: å„å‡¦ç†ã®å®Ÿè¡Œæ™‚é–“ã‚’æ¸¬å®šã—æœ€é©åŒ–
- **ç›®æ¨™**: SMSé€ä¿¡3ç§’ä»¥å†…ã€OTPæ¤œè¨¼1ç§’ä»¥å†…
- **ç›£è¦–**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®è¨˜éŒ²

### 2. æŠ€è¡“ä»•æ§˜

#### 2.1 ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/phone-verification/index.ts`
- **ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2.0
- **æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2.1 (ä¿®æ­£ç‰ˆ)

#### 2.2 ä¸»è¦ãªä¿®æ­£å†…å®¹

##### 2.2.1 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ©Ÿèƒ½ã®è¿½åŠ 
```typescript
// DBé–¢æ•°å‘¼ã³å‡ºã—ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
async function callDatabaseFunction<T>(
  supabase: SupabaseClient,
  functionName: string,
  params: any
): Promise<{ data: T | null; error: any }> {
  try {
    const result = await supabase.rpc(functionName, params);
    return result;
  } catch (error) {
    // é–¢æ•°ä¸å­˜åœ¨ã‚¨ãƒ©ãƒ¼ã®ç‰¹åˆ¥å‡¦ç†
    if (error.message?.includes('function') && error.message?.includes('does not exist')) {
      console.error(`Database function ${functionName} does not exist:`, error);
      return {
        data: null,
        error: {
          code: 'FUNCTION_NOT_FOUND',
          message: `Database function ${functionName} is not implemented`,
          details: error.message
        }
      };
    }
    
    // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼
    console.error(`Database function ${functionName} error:`, error);
    return {
      data: null,
      error: {
        code: 'DATABASE_ERROR',
        message: 'Database operation failed',
        details: error.message
      }
    };
  }
}
```

##### 2.2.2 ç›£æŸ»ãƒ­ã‚°æ©Ÿèƒ½ã®è¿½åŠ 
```typescript
// ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²é–¢æ•°
async function logAuditEvent(
  supabase: SupabaseClient,
  tableName: string,
  action: string,
  userId: string | null,
  details: any,
  success: boolean = true,
  errorMessage: string | null = null,
  executionTimeMs: number | null = null
): Promise<void> {
  try {
    const { error } = await callDatabaseFunction(supabase, 'log_audit_event', {
      p_table_name: tableName,
      p_action: action,
      p_user_id: userId,
      p_details: details,
      p_success: success,
      p_error_message: errorMessage,
      p_execution_time_ms: executionTimeMs
    });
    
    if (error) {
      console.error('Failed to log audit event:', error);
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°
      console.log('AUDIT LOG:', {
        table: tableName,
        action,
        userId,
        details,
        success,
        error: errorMessage,
        executionTime: executionTimeMs,
        timestamp: new Date().toISOString()
      });
    }
  } catch (err) {
    console.error('Audit logging error:', err);
  }
}
```

##### 2.2.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°æ©Ÿèƒ½ã®è¿½åŠ 
```typescript
// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°è¨˜éŒ²é–¢æ•°
async function logSecurityEvent(
  supabase: SupabaseClient,
  eventType: string,
  userId: string | null,
  phoneNumber: string | null,
  eventData: any,
  severityLevel: number = 3,
  request: Request
): Promise<void> {
  try {
    const requestInfo = {
      ip: request.headers.get('x-forwarded-for') || 
          request.headers.get('x-real-ip') || 
          'unknown',
      userAgent: request.headers.get('user-agent') || 'unknown',
      referer: request.headers.get('referer') || null,
      timestamp: new Date().toISOString()
    };
    
    const { error } = await callDatabaseFunction(supabase, 'log_security_event', {
      p_event_type: eventType,
      p_user_id: userId,
      p_phone_number: phoneNumber,
      p_event_data: { ...eventData, request: requestInfo },
      p_severity_level: severityLevel
    });
    
    if (error) {
      console.error('Failed to log security event:', error);
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°
      console.log('SECURITY LOG:', {
        eventType,
        userId,
        phoneNumber: phoneNumber ? '[REDACTED]' : null,
        eventData,
        severityLevel,
        request: requestInfo
      });
    }
  } catch (err) {
    console.error('Security logging error:', err);
  }
}
```

##### 2.2.4 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šæ©Ÿèƒ½
```typescript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šãƒ˜ãƒ«ãƒ‘ãƒ¼
class PerformanceTimer {
  private startTime: number;
  private operation: string;
  
  constructor(operation: string) {
    this.operation = operation;
    this.startTime = performance.now();
  }
  
  end(): number {
    const endTime = performance.now();
    const executionTime = Math.round(endTime - this.startTime);
    console.log(`Performance: ${this.operation} took ${executionTime}ms`);
    return executionTime;
  }
}
```

##### 2.2.5 æ”¹å–„ã•ã‚ŒãŸãƒ¡ã‚¤ãƒ³ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
```typescript
serve(async (req) => {
  const timer = new PerformanceTimer('phone-verification-request');
  
  if (req.method === 'OPTIONS') {
    return corsResponse();
  }

  let requestData;
  let normalizedPhone: string | null = null;
  
  try {
    requestData = await req.json();
    const { action, phoneNumber, code } = requestData;
    
    // é›»è©±ç•ªå·ã®æ­£è¦åŒ–
    normalizedPhone = phoneNumber ? normalizePhoneNumber(phoneNumber) : null;
    
    // åŸºæœ¬çš„ãªå…¥åŠ›æ¤œè¨¼
    if (!action) {
      await logAuditEvent(
        supabaseAdmin,
        'phone_verifications',
        'VALIDATION_ERROR',
        null,
        { error: 'missing_action', request: requestData },
        false,
        'Action parameter is required'
      );
      
      return corsResponse({ 
        error: 'invalid_request',
        message: 'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå¿…è¦ã§ã™ã€‚' 
      }, 400);
    }

    if (action === 'send_code') {
      return await handleSendCode(req, phoneNumber, normalizedPhone, supabaseAdmin);
    }

    if (action === 'verify_code') {
      return await handleVerifyCode(req, phoneNumber, normalizedPhone, code, supabaseAdmin);
    }

    return corsResponse({ 
      error: 'invalid_action',
      message: 'ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚' 
    }, 400);

  } catch (error) {
    const executionTime = timer.end();
    
    await logAuditEvent(
      supabaseAdmin,
      'phone_verifications',
      'SYSTEM_ERROR',
      null,
      { 
        error: error.message,
        stack: error.stack,
        request: requestData
      },
      false,
      error.message,
      executionTime
    );
    
    return corsResponse({ 
      error: 'system_error',
      message: 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚' 
    }, 500);
  }
});
```

##### 2.2.6 SMSé€ä¿¡å‡¦ç†ã®æ”¹å–„
```typescript
async function handleSendCode(
  req: Request,
  phoneNumber: string,
  normalizedPhone: string | null,
  supabaseAdmin: SupabaseClient
): Promise<Response> {
  const timer = new PerformanceTimer('send-sms');
  
  try {
    // å…¥åŠ›æ¤œè¨¼
    if (!phoneNumber) {
      await logAuditEvent(
        supabaseAdmin,
        'phone_verifications',
        'VALIDATION_ERROR',
        null,
        { error: 'missing_phone_number' },
        false,
        'Phone number is required'
      );
      
      return corsResponse({ 
        error: 'invalid_request',
        message: 'é›»è©±ç•ªå·ãŒå¿…è¦ã§ã™ã€‚' 
      }, 400);
    }
    
    if (!normalizedPhone) {
      await logSecurityEvent(
        supabaseAdmin,
        'INVALID_PHONE_FORMAT',
        null,
        phoneNumber,
        { originalPhone: phoneNumber },
        2,
        req
      );
      
      return corsResponse({ 
        error: 'invalid_phone_format',
        message: 'é›»è©±ç•ªå·ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚' 
      }, 400);
    }
    
    // é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆDBé–¢æ•°å‘¼ã³å‡ºã—ï¼‰
    const { data: availabilityCheck, error: availabilityError } = 
      await callDatabaseFunction(supabaseAdmin, 'check_phone_availability', {
        phone_input: normalizedPhone
      });
    
    if (availabilityError) {
      const executionTime = timer.end();
      
      if (availabilityError.code === 'FUNCTION_NOT_FOUND') {
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: åŸºæœ¬çš„ãªé‡è¤‡ãƒã‚§ãƒƒã‚¯
        console.warn('Using fallback duplicate check');
        
        const { data: existingVerifications, error: queryError } = await supabaseAdmin
          .from('phone_verifications')
          .select('id')
          .eq('phone_number', normalizedPhone)
          .eq('is_active', true);
        
        if (queryError) {
          await logAuditEvent(
            supabaseAdmin,
            'phone_verifications',
            'FALLBACK_CHECK_ERROR',
            null,
            { error: queryError.message, phone_hash: hashPhoneNumber(normalizedPhone) },
            false,
            queryError.message,
            executionTime
          );
          
          return corsResponse({ 
            error: 'system_error',
            message: 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚' 
          }, 500);
        }
        
        if (existingVerifications && existingVerifications.length > 0) {
          await logSecurityEvent(
            supabaseAdmin,
            'PHONE_DUPLICATE_ATTEMPT',
            null,
            normalizedPhone,
            { 
              method: 'fallback_check',
              existingCount: existingVerifications.length 
            },
            4,
            req
          );
          
          return corsResponse({ 
            error: 'phone_already_registered',
            message: 'ã“ã®é›»è©±ç•ªå·ã¯æ—¢ã«ä»–ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚åˆ¥ã®é›»è©±ç•ªå·ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚' 
          }, 409);
        }
      } else {
        // ãã®ä»–ã®DBã‚¨ãƒ©ãƒ¼
        await logAuditEvent(
          supabaseAdmin,
          'phone_verifications',
          'AVAILABILITY_CHECK_ERROR',
          null,
          { 
            error: availabilityError.message,
            phone_hash: hashPhoneNumber(normalizedPhone)
          },
          false,
          availabilityError.message,
          executionTime
        );
        
        return corsResponse({ 
          error: 'system_error',
          message: 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚' 
        }, 500);
      }
    } else if (!availabilityCheck?.available) {
      // é‡è¤‡æ¤œå‡º
      await logSecurityEvent(
        supabaseAdmin,
        'PHONE_DUPLICATE_ATTEMPT',
        null,
        normalizedPhone,
        { 
          method: 'database_function',
          error: availabilityCheck?.error,
          message: availabilityCheck?.message
        },
        4,
        req
      );
      
      return corsResponse({ 
        error: availabilityCheck?.error || 'phone_not_available',
        message: availabilityCheck?.message || 'ã“ã®é›»è©±ç•ªå·ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚' 
      }, 409);
    }
    
    // SMSé€ä¿¡å‡¦ç†
    const smsResult = await sendVerificationCode(normalizedPhone);
    const executionTime = timer.end();
    
    if (smsResult.success) {
      await logAuditEvent(
        supabaseAdmin,
        'phone_verifications',
        'SEND_SMS',
        null,
        { 
          phone_hash: hashPhoneNumber(normalizedPhone),
          provider: 'twilio'
        },
        true,
        null,
        executionTime
      );
      
      return corsResponse({ 
        success: true, 
        message: 'SMSé€ä¿¡ãŒå®Œäº†ã—ã¾ã—ãŸã€‚' 
      });
    } else {
      await logAuditEvent(
        supabaseAdmin,
        'phone_verifications',
        'SEND_SMS',
        null,
        { 
          phone_hash: hashPhoneNumber(normalizedPhone),
          error: smsResult.error,
          provider: 'twilio'
        },
        false,
        smsResult.error,
        executionTime
      );
      
      return corsResponse({ 
        error: 'sms_send_failed',
        message: 'SMSé€ä¿¡ã« failed ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚' 
      }, 500);
    }
    
  } catch (error) {
    const executionTime = timer.end();
    
    await logAuditEvent(
      supabaseAdmin,
      'phone_verifications',
      'SEND_SMS',
      null,
      { 
        error: error.message,
        phone_hash: normalizedPhone ? hashPhoneNumber(normalizedPhone) : null
      },
      false,
      error.message,
      executionTime
    );
    
    return corsResponse({ 
      error: 'system_error',
      message: 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚' 
    }, 500);
  }
}
```

#### 2.3 ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°

##### 2.3.1 é›»è©±ç•ªå·ãƒãƒƒã‚·ãƒ¥åŒ–
```typescript
function hashPhoneNumber(phoneNumber: string): string {
  const encoder = new TextEncoder();
  const data = encoder.encode(phoneNumber);
  return crypto.subtle.digest('SHA-256', data)
    .then(hash => Array.from(new Uint8Array(hash))
      .map(b => b.toString(16).padStart(2, '0'))
      .join('')
    );
}
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆä»•æ§˜

### 3. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

#### 3.1 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
- **TC-001**: DBé–¢æ•°ä¸å­˜åœ¨æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œ
- **TC-002**: DBæ¥ç¶šã‚¨ãƒ©ãƒ¼æ™‚ã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **TC-003**: ç„¡åŠ¹ãªå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†
- **TC-004**: Twilioã‚µãƒ¼ãƒ“ã‚¹ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†

#### 3.2 ãƒ­ã‚°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- **TC-005**: ç›£æŸ»ãƒ­ã‚°ã®æ­£ç¢ºãªè¨˜éŒ²
- **TC-006**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°ã®è¨˜éŒ²
- **TC-007**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®è¨˜éŒ²
- **TC-008**: ãƒ­ã‚°è¨˜éŒ²å¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

#### 3.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
- **TC-009**: é‡è¤‡æ¤œå‡ºã®æ­£ç¢ºæ€§
- **TC-010**: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å‹•ä½œ
- **TC-011**: ä¸æ­£ãƒ‡ãƒ¼ã‚¿ã®æ¤œå‡ºã¨è¨˜éŒ²
- **TC-012**: å€‹äººæƒ…å ±ã®é©åˆ‡ãªãƒã‚¹ã‚­ãƒ³ã‚°

## ğŸ“… å®Ÿè£…è¨ˆç”»

### 4. æ®µéšçš„å®Ÿè£…

#### Phase 1: ç·Šæ€¥ä¿®æ­£ï¼ˆå³åº§ã«å®Ÿæ–½ï¼‰
1. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ©Ÿèƒ½ã®è¿½åŠ 
2. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã®å®Ÿè£…
3. åŸºæœ¬çš„ãªãƒ­ã‚°æ©Ÿèƒ½ã®è¿½åŠ 

#### Phase 2: æ©Ÿèƒ½å¼·åŒ–ï¼ˆ1é€±é–“ä»¥å†…ï¼‰
1. åŒ…æ‹¬çš„ãªç›£æŸ»ãƒ­ã‚°å®Ÿè£…
2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°æ©Ÿèƒ½å®Ÿè£…
3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šæ©Ÿèƒ½è¿½åŠ 

#### Phase 3: æœ€é©åŒ–ï¼ˆ2é€±é–“ä»¥å†…ï¼‰
1. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
2. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å¤šè¨€èªå¯¾å¿œ
3. ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å¯¾å¿œ

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

#### 5.1 ãƒ‡ãƒ¼ã‚¿ä¿è­·
- é›»è©±ç•ªå·ã®ãƒãƒƒã‚·ãƒ¥åŒ–è¨˜éŒ²
- ãƒ­ã‚°å†…ã®å€‹äººæƒ…å ±ãƒã‚¹ã‚­ãƒ³ã‚°
- API ã‚­ãƒ¼ãƒ»ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®é©åˆ‡ãªç®¡ç†

#### 5.2 ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹å¯¾ç­–
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…
- ç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡º
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®è¨˜éŒ²

#### 5.3 ç›£æŸ»è¨¼è·¡
- å…¨ã¦ã®é‡è¦æ“ä½œã®è¨˜éŒ²
- ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®è©³ç´°æƒ…å ±ä¿å­˜
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æƒ…å ±ã®è¨˜éŒ²

---

## å®Ÿè£…ãƒ­ã‚°æ›´æ–°å±¥æ­´

**2025-01-28**: phone-verification Edge Function ã®åŒ…æ‹¬çš„ãªä¿®æ­£ä»•æ§˜æ›¸ã‚’ä½œæˆã€‚ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãƒ­ã‚°æ©Ÿèƒ½ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã®å¼·åŒ–ä»•æ§˜ã‚’ç­–å®šã€‚
