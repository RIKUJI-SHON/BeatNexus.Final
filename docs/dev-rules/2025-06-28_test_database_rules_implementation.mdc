---
description:
globs:
alwaysApply: false
---
# 🧪 テストデータベース運用ルール実装ログ

## 📅 実装日
2025-06-28

## 🎯 概要
BeatNexusプロジェクトにおける新機能開発時の安全性確保のため、テストデータベース運用ルールを策定・実装。本番環境のデータベース破損リスクを完全に排除し、安全な開発プロセスを確立。

## 🔍 実装背景
### 問題認識
- 新機能実装時に本番データベースで直接実験することのリスク
- データベーススキーマ変更による本番環境への影響可能性
- 本番データベース破損時の復旧の困難性
- 開発者による意図しない本番データベース操作のリスク

### 解決アプローチ
- 専用テストデータベース環境の明確な定義
- 新機能開発の必須プロセス標準化
- マイグレーション管理の徹底
- 本番環境適用の安全なプロセス確立

## 📝 実装内容

### ✅ メインルールファイル作成
**ファイル**: `.cursor/rules/dev-rules/2025-06-28_test_database_development_rules.mdc`

#### 重要な定義
1. **データベース環境区分**
   - 本番DB: `qgqcjtjxaoplhxurbpis` (BEATNEXUS-CURSOR)
   - テストDB: `wdttluticnlqzmqmfvgt` (BeatNexus.bolt)

2. **必須開発プロセス**
   - 新機能実装は必ずテストDBで開始
   - 本番DBでの直接実装・実験は絶対禁止
   - 段階的検証プロセス（実装→検証→マイグレーション作成→本番適用）

3. **マイグレーション管理標準**
   - 命名規則: `YYYYMMDDHHMMSS_機能名_説明.sql`
   - 必須ヘッダー情報（機能名、作成日、実装者、検証状況等）
   - ロールバック手順の必須記録

### ✅ BeatNexus.mdcファイル更新
**ファイル**: `.cursor/rules/dev-rules/BeatNexus.mdc`

#### 追加内容
```markdown
## 🧪 開発プロセス重要ルール
**⚠️ 必須**: 新機能実装は必ずテストDB環境で開始してください！
詳細ルールは `2025-06-28_test_database_development_rules.mdc` を参照
```

### ✅ 実装された主要ルール

#### 1. 開発開始時の原則
- **必須ルール**: 新機能実装は必ずテストDBで開始
- **禁止事項**: 本番DBでの直接実装・実験

#### 2. 実装ステップ（必須順序）
1. **テストDB接続確認**
2. **テストDB環境での実装**
3. **テストDB環境での検証**
4. **マイグレーション情報の記録**（必須）

#### 3. マイグレーション管理標準
- ファイル命名規則の統一
- 必須記録項目の定義
- ロールバック手順の必須化

#### 4. 本番環境適用プロセス
- 事前チェックリスト
- 段階的適用手順
- 緊急時対応プロセス

#### 5. ファイル管理標準
- 実装ログ保存ルール
- Git管理ルール
- コミットメッセージ形式

## 🔧 技術詳細

### セキュリティ・安全性対策
1. **環境分離**
   - 本番DB認証情報の厳重管理
   - テストDB認証情報の適切な分離
   - 環境変数による接続先制御

2. **本番影響最小化**
   - 本番DBへの直接接続は必要最小限
   - 実験的な変更は絶対にテストDBのみ
   - 本番適用前の十分な検証期間確保

### 品質保証プロセス
1. **テストDB検証必須項目**
   - 機能動作確認
   - データ整合性確認
   - パフォーマンス確認

2. **緊急時対応**
   - ロールバック手順の準備
   - 影響範囲調査プロセス
   - 修正版の実装・検証手順

## 🎯 期待される効果

### 1. リスク削減
- 本番データベース破損リスクの完全排除
- 意図しない本番環境変更の防止
- データ損失リスクの最小化

### 2. 開発効率向上
- 安心して実験できる環境の提供
- 段階的検証による品質向上
- ロールバック可能な安全な本番適用

### 3. チーム協力向上
- 標準化されたプロセスによる混乱防止
- 明確なルールによる責任分界の明確化
- ドキュメント化された手順による属人化防止

## 📊 運用指針

### 定期的な確認事項
- テストDB環境の本番DB同期状況
- マイグレーションファイルの整合性
- 実装ログの完全性

### 継続的改善
- ルールの定期的見直し
- プロセスの効率化検討
- 新技術・新手法への対応

## ✅ 検証項目
- [x] テストデータベース運用ルールファイル作成
- [x] BeatNexus.mdcファイルへの参照追加
- [x] 実装ログ作成
- [ ] チーム内でのルール周知（今後）
- [ ] 実際の新機能開発での運用確認（今後）

## 🔗 関連ファイル
- `.cursor/rules/dev-rules/2025-06-28_test_database_development_rules.mdc` - メインルールファイル
- `.cursor/rules/dev-rules/BeatNexus.mdc` - 更新されたプロジェクトルール
- `.cursor/rules/dev-rules/2025-06-28_test_database_rules_implementation.mdc` - 本実装ログ

## 📞 今後の課題・改善点
1. **自動化の検討**: CI/CDでのマイグレーション適用自動化
2. **監視の強化**: 本番DB変更の自動検知システム
3. **教育の充実**: 新しい開発者向けのルール教育プロセス

---
**実装者**: AI Assistant  
**レビュー**: 完了  
**ステータス**: 運用開始 - 2025-06-28より適用
